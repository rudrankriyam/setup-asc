name: CI

on:
  push:
    branches: [main]
  pull_request:

jobs:
  setup-latest:
    name: "latest (${{ matrix.os }})"
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
    steps:
      - uses: actions/checkout@v4

      - id: setup
        uses: ./
        with:
          version: latest

      - name: Verify install
        shell: bash
        run: |
          echo "Path: ${{ steps.setup.outputs.asc-path }}"
          echo "Version: ${{ steps.setup.outputs.asc-version }}"
          asc version
          asc --help

  setup-pinned:
    name: "pinned (${{ matrix.os }})"
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macos-latest]
    steps:
      - uses: actions/checkout@v4

      - id: setup
        uses: ./
        with:
          version: 0.28.12

      - name: Verify pinned version
        shell: bash
        run: |
          INSTALLED="$(asc version 2>&1 || true)"
          echo "Installed: ${INSTALLED}"
          asc --help

  setup-no-cache:
    name: "no-cache (ubuntu-latest)"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: ./
        with:
          version: latest
          cache: "false"

      - name: Verify install
        run: asc version
